{% extends "::vueMere.html.twig" %}
{% block title %}Rechercher des activités{% endblock %}
{% block activeRechercher %}active{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('bundles/mooveactivite/css/rechercher.css') }}">
    <link rel="stylesheet" href="{{ asset('bundles/mooveactivite/css/bootstrap-slider/bootstrap-slider.css') }}">
{% endblock %}

{% block body %} 
    <!-- Titre de la page -->
    <section class="content-header">
      <h1>Rechercher</h1>
    </section>
     
    <!-- Contenu principal -->
    <section class="content">
        <div class="row">
            <div class="col-md-12">
                <form class="form-inline">
                    <input id="autocomplete" type="text" class="form-control" placeholder="Entrez une ville...">
                    <button type="submit" class="btn btn-default">Rechercher</button>
                </form>
                <p>{{ nbActivites }} résultats</p>
            </div>
            <div class="col-md-4 pull-right">
                <h2>Filtres de recherche</h2>
                
                <form name="filtre" method="post">
                <!-- le formulaire doit ressembler a ca
                                        heure de départ & arriver (un double)
                                        liste a puce sport    | liste a puce niveau (en parallel)
                                        bouton radio avec photo  |   spinner (order by)
                                        nbPlace max (de 0 a 20)
                                        nbPlaceRestante (un double avec min et max)
                                        distance max du pts (qu'on a pas regler du tout)-->
                <label for="heure">Heure de départ</label><br>
                <input id="heure" name="heure" type="text"/><br><br>
                <div class="col-md-6">
                <!-- Liste des sports. Le premier cochera / décochera tout les autres. -->
                    <label>Sport</label><br/>
                    <input type="checkbox" name="name_allSport" id="name_allSport" onChange='javascript:checkSport()' value=""/> Tous les sports<br/>
                    {% for sport in tabSport %}    
                        <input type="checkbox" name="name_{{ sport.nom }}" id="id_{{ sport.nom }}" value="{{ sport.nom }}" /> {{ sport.nom }}<br/>
                    {% endfor %}
                </div>
                <div class="col-md-6">
                <!-- Liste des Niveaux. Le premier cochera / décochera tout les autres. -->
                    <label>Niveau</label> <br/>
                    <input type="checkbox" name="name_allNiveau" id="name_allNiveau" onChange='javascript:checkNiveau()' value=""/> Tous les niveaux<br/>
                    {% for niveau in tabNiveau %}    
                        <input type="checkbox" name="name_{{ niveau.libelle }}" id="id_{{ niveau.libelle }}" /> {{ niveau.libelle }}<br/>
                    {% endfor %}
                </div>
                <br>
                <!-- Radio groupe des photos -->
                    <label> Photo </label></br>
                    <input type="radio" name="photo" id="tous" value="all" checked> Tout<br/>
                    <input type="radio" name="photo" id="avec" value="yes"> Avec photo<br/><br>
                    <!--<input type="radio" name="photo" id="sans" value="no" >Sans photo<br/>-->

                    <label for="nbPlaces">Nombres de places</label><br>
                    <input id="nbPlaces" name="nbPlaces" type="text"/><br><br>
                    <label for="nbPlacesRestantes">Nombres de places restantes</label><br>
                    <input id="nbPlacesRestantes" name="nbPlacesRestantes" type="text"/><br><br>
                    <label for="rayonRecherche">Rayon de recherche en km</label><br>
                    <input id="rayonRecherche" name="rayonRecherche" type="text"/><br><br>
                    <button type="submit" class="btn btn-primary">Filtrer</button>
        		</form>
                
                
            </div>
            <div class="col-md-8">
                <div class="list-group">
                    {% for activite in tabActivites %}
                      <a href="{{ path('moove_activite_detailsActivite', {idActivite: activite.id}) }}" class="list-group-item">
                        <div class="col-md-2 media">
                            <div class="media-left">
                                <img class="media-object img-rounded img-responsive"  src="{{ asset(activite.organisateur.URLAvatar) }}" alt="Photo de l'organisateur" >
                            </div>
                        </div>
                        <div class="col-md-3">
                            <p>{{ activite.organisateur.prenom ~ " " ~ activite.organisateur.nom }}</p>
                            <p>{{ ('now'|date('Y') - activite.organisateur.dateNaissance|date('Y') - 1) + ('now'|date('2010-m-d')|date('U') - activite.organisateur.dateNaissance|date('2010-m-d')|date('U') >= 0 ? 1 : 0) }} ans</p>
                            <p>Niveau organisateur</p>
                        </div>
                        <div class="col-md-4 text-center">
                            <h4 class="list-group-item-heading">{{ activite.dateHeureRDV | localizeddate('none', 'none', null, null, "cccc d LLLL yyyy à H'h'mm")}}</h4>
                            <p>Lieu RDV : {{ activite.lieuRDV.ville }}</p>
                            <p>Sport : {{ activite.sportPratique.nom }}</p>
                        </div>
                        <div class="col-md-3 text-right">
                            <h3>{# nbParticipants #} <small> participants</small></h3>
                            <p>{{ activite.nbPlaces }} places restantes</p>
                            <p>Niveau : {{ activite.niveauRequis.libelle }}</p>
                        </div>
                      </a>

                    {% else %}
                        Aucune activité
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
    
{% endblock %}
{% block javascripts %}
    <script src="{{ asset('bundles/mooveactivite/js/bootstrap-slider.js') }}"></script>
    <script type="text/javascript">
        $("#heure").slider({
          tooltip_split: true,
          formatter: function(value) {
            return value + 'h';
          },
          min: 0,
          max: 24,
          value: [0, 24],
          focus: true,
          handle: 'square',
        });
        
        $("#nbPlaces").slider({
          tooltip_split: true,
          formatter: function(value) {
            return value + ' places';
          },
          min: 1,
          max: 20,
          value: [1, 20],
          focus: true,
          handle: 'square',
        });
        $("#nbPlacesRestantes").slider({
          formatter: function(value) {
            return 'Au moins ' + value + ' places restantes';
          },
          min: 1,
          max: 19,
          value: 1,
          focus: true,
          handle: 'square',
        });
        $("#rayonRecherche").slider({
          formatter: function(value) {
            return 'Rayon de ' + value + 'km';
          },
          min: 1,
          max: 100,
          value: 1,
          focus: true,
          handle: 'square',
        });
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmo1B7t569caLPAVZZNdcoH97JCnHRqNM&signed_in=true&libraries=places&callback=initAutocomplete"
        async defer></script>
    <script>
        var input = (document.getElementById('autocomplete'));
        var autocomplete;
        
        function initAutocomplete() {
          // Create the autocomplete object, restricting the search to geographical
          // location types.
          autocomplete = new google.maps.places.Autocomplete(input, {types: ['geocode']});
        }
    </script>
    <script>
    	function checkSport()
    	{
    		var form = document.filtre;
    		var isChecked = form.name_allSport.checked;
    		
    		{% for sport in tabSport %}    
    			form.name_{{ sport.nom }}.checked = isChecked
            {% endfor %}	
    	}
    	
    	function checkNiveau()
    	{
    		var form = document.filtre;
    		var isChecked = form.name_allNiveau.checked;
    		
    		{% for niveau in tabNiveau %}    
    			form.name_{{ niveau.libelle }}.checked = isChecked
            {% endfor %}	
    	}
    </script>
{% endblock %}