<?php

namespace moove\ActiviteBundle\Entity;

use Doctrine\ORM\EntityRepository;

use Doctrine\ORM\QueryBuilder;

/**
 * ActiviteRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class ActiviteRepository extends EntityRepository
{


    public function findByUtilisateur($idUtilisateur, $terminer)
    {
        
        
        $requete = $this->getAllActivityForUser($idUtilisateur);
        
        
        $requete->andWhere('a.estTerminee = :fini')
                ->setParameter('fini', $terminer)
        ;
        
        $query = $requete->getQuery();
        
        return $query->getResult();
    }
        


    /**
     * 
     * @param $idUtilisateur integer de l'user
     * @return (queryBuilder)
     */
    private function getAllActivityForUser($idUtilisateur)
    {
        $requete = $this->_em->createQueryBuilder()
            ->select('a')
            ->from($this->_entityName, 'a')
            ->leftJoin('mooveActiviteBundle:participer', 'p')
            ->where('p.idUtilisateur = :idUtilisateur')
            ->orderBy('a.dateHeureRDV', 'DESC')
            ->setParameter('idUtilisateur', $idUtilisateur)
        ;
        
        return $requete;
        
    }
}
